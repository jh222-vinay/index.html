<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batch PDF Translator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Library for direct PDF generation and download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&display=swap');
        
        body { background-color: #f8fafc; font-family: 'Inter', sans-serif; }
        
        .pdf-page-render {
            font-family: 'Crimson Pro', serif;
            background: white;
            width: 210mm;
            min-height: 297mm;
            padding: 25mm;
            margin: 20px auto;
            line-height: 1.8;
            color: #1a1a1a;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
        }

        .page-break { page-break-after: always; height: 0; }

        .loader-bar {
            height: 4px;
            width: 0%;
            background: #2563eb;
            transition: width 0.4s ease;
        }

        #render-area {
            transform-origin: top center;
        }
    </style>
</head>
<body class="pb-20">

    <nav class="bg-white border-b sticky top-0 z-50 px-6 py-4 shadow-sm">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
                <h1 class="text-xl font-bold text-slate-900">Document Batch Translator</h1>
                <p id="status-label" class="text-xs text-slate-500 font-medium">Select multiple images to begin</p>
            </div>
            
            <div class="flex items-center gap-3">
                <label class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-lg font-bold cursor-pointer transition-all flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                    Add Multiple Images
                    <input type="file" id="multi-file-input" class="hidden" accept="image/*" multiple>
                </label>

                <button id="download-pdf-btn" class="hidden bg-slate-900 hover:bg-black text-white px-5 py-2.5 rounded-lg font-bold transition-all flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4-4v12"></path></svg>
                    Download PDF
                </button>
            </div>
        </div>
        <div class="absolute bottom-0 left-0 w-full h-1 bg-slate-100">
            <div id="loader-progress" class="loader-bar"></div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto mt-10 px-4">
        <div id="processing-info" class="hidden mb-10 text-center">
            <p class="text-blue-600 font-bold animate-pulse" id="processing-text">Reading page 1...</p>
        </div>

        <div id="render-area">
            <div id="empty-state" class="py-32 text-center bg-white rounded-3xl border-2 border-dashed border-slate-200">
                <div class="text-6xl mb-4">ðŸ“„âœ¨</div>
                <h2 class="text-xl font-bold text-slate-800">No Pages Loaded</h2>
                <p class="text-slate-500">Upload multiple JPG/PNG images of your Hindi text.</p>
            </div>
        </div>
    </main>

    <script>
        const apiKey = "AIzaSyA8sL--8pnJ5sT0gM-8sBVX1pAVX1TQc9Q"; 
        const multiInput = document.getElementById('multi-file-input');
        const renderArea = document.getElementById('render-area');
        const emptyState = document.getElementById('empty-state');
        const downloadBtn = document.getElementById('download-pdf-btn');
        const loaderBar = document.getElementById('loader-progress');
        const statusLabel = document.getElementById('status-label');
        const processingInfo = document.getElementById('processing-info');
        const processingText = document.getElementById('processing-text');

        multiInput.addEventListener('change', async (e) => {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;
            await processImages(files);
        });

        async function processImages(files) {
            renderArea.innerHTML = '';
            emptyState.classList.add('hidden');
            processingInfo.classList.remove('hidden');
            downloadBtn.classList.add('hidden');
            
            let count = 0;
            const total = files.length;

            for (const file of files) {
                count++;
                updateProgress(count, total);
                
                try {
                    const base64 = await fileToBase64(file);
                    const translatedHtml = await getTranslation(base64);
                    
                    const pageDiv = document.createElement('div');
                    pageDiv.className = 'pdf-page-render';
                    pageDiv.innerHTML = translatedHtml;
                    
                    renderArea.appendChild(pageDiv);
                    
                    if (count < total) {
                        const br = document.createElement('div');
                        br.className = 'page-break';
                        renderArea.appendChild(br);
                    }
                } catch (err) {
                    console.error("Page error:", err);
                    const errDiv = document.createElement('div');
                    errDiv.className = 'pdf-page-render text-red-500';
                    errDiv.innerHTML = `<h1>Error Page ${count}</h1><p>Could not process this image.</p>`;
                    renderArea.appendChild(errDiv);
                }
            }

            processingInfo.classList.add('hidden');
            downloadBtn.classList.remove('hidden');
            statusLabel.innerText = `${total} pages processed.`;
        }

        function updateProgress(current, total) {
            const perc = (current / total) * 100;
            loaderBar.style.width = `${perc}%`;
            processingText.innerText = `RECONSTRUCTING PAGE ${current} OF ${total}...`;
            statusLabel.innerText = `Progress: ${current}/${total}`;
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = e => reject(e);
            });
        }

        async function getTranslation(base64) {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [
                            { text: "Translate all Hindi text in this image to English. Return ONLY the HTML body content. Use <h1 class='text-center text-3xl font-bold uppercase mb-10'> for headings. Use <div class='mb-12'> for gaps between questions. Use <strong> for bold labels." },
                            { inlineData: { mimeType: "image/png", data: base64 } }
                        ]
                    }]
                })
            });
            const data = await response.json();
            const raw = data.candidates[0].content.parts[0].text;
            return raw.replace(/```html|```/g, '').trim();
        }

        downloadBtn.onclick = () => {
            const opt = {
                margin: 0,
                filename: 'Translated_Document.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            statusLabel.innerText = "Generating File...";
            html2pdf().set(opt).from(renderArea).save().then(() => {
                statusLabel.innerText = "Download Complete!";
            });
        };
    </script>
</body>
</html>

